import {mqtt_type_writer} from './_utils.jsy'

export function mqtt_encode_pubrec(mqtt_level, pkt) ::
  return _mqtt_encode_pubxxx @ 0x50, mqtt_level, pkt

export function _mqtt_encode_pubxxx(hdr, mqtt_level, pkt) ::
  const wrt = new mqtt_type_writer()

  wrt.u16(pkt.pkt_id)
  if 5 <= mqtt_level ::
    wrt.props(pkt.props)
    wrt.u8_reason @ pkt.reason

  else ::
    wrt.u8_reason @ pkt.return_code || pkt.reason

  return wrt.as_pkt(hdr)

