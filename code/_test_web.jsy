import MQTTClient from './tiny_client_web.jsy'

::!>
  const c = new MQTTClient()
  await c.with_websock('ws://127.0.0.1:9001')

  c.connect @:
    connect_flags: @{}
      will_flag: 1
      will_qos: 0

    keep_alive: 60

    payload: @{}
      client_id: 'swh_demo'
      will_topic: 'swh/aaa/awesome'
      will_payload: 'will is awesome'

  await delay(10)

  c.publish @:
    topic: 'swh/test-topic'
    payload: 'awesome from web'

  await delay(10)

  //c.disconnect()

function delay(ms) ::
  return @{} then(y) :: setTimeout(y,ms)

